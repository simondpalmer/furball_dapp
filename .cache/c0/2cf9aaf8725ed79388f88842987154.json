{"id":"../node_modules/@ceramicnetwork/http-client/lib/document.js","dependencies":[{"name":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\http-client\\lib\\document.js.map","includedInParent":true,"mtime":499162500000},{"name":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\package.json","includedInParent":true,"mtime":1612734035267},{"name":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\http-client\\package.json","includedInParent":true,"mtime":1612644319599},{"name":"@ceramicnetwork/common","loc":{"line":6,"column":25},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\http-client\\lib\\document.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\common\\lib\\index.js"},{"name":"@ceramicnetwork/docid","loc":{"line":7,"column":40},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\http-client\\lib\\document.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\docid\\lib\\index.js"},{"name":"./utils","loc":{"line":8,"column":24},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\http-client\\lib\\document.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\http-client\\lib\\utils.js"}],"generated":{"js":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst common_1 = require(\"@ceramicnetwork/common\");\nconst docid_1 = __importDefault(require(\"@ceramicnetwork/docid\"));\nconst utils_1 = require(\"./utils\");\nclass Document extends common_1.Doctype {\n    constructor(state, context, _apiUrl, config = { docSyncEnabled: false }) {\n        super(state, context);\n        this._apiUrl = _apiUrl;\n        this._syncEnabled = config.docSyncEnabled;\n        this._syncInterval = config.docSyncInterval;\n        if (this._syncEnabled) {\n            this._syncPeriodically();\n        }\n    }\n    async _syncState() {\n        const { state } = await utils_1.fetchJson(this._apiUrl + '/documents/' + this.id.toString());\n        if (JSON.stringify(common_1.DoctypeUtils.serializeState(this.state)) !== JSON.stringify(state)) {\n            this.state = common_1.DoctypeUtils.deserializeState(state);\n            this.emit('change');\n        }\n    }\n    async _syncPeriodically() {\n        while (this._syncEnabled) {\n            try {\n                await this._syncState();\n            }\n            catch (e) {\n            }\n            await utils_1.delay(this._syncInterval);\n        }\n    }\n    get id() {\n        return new docid_1.default(this.state.doctype, this.state.log[0].cid);\n    }\n    static async createFromGenesis(apiUrl, doctype, genesis, context, docOpts = {}, config) {\n        const { state } = await utils_1.fetchJson(apiUrl + '/documents', {\n            method: 'post',\n            body: {\n                doctype,\n                genesis: common_1.DoctypeUtils.serializeCommit(genesis),\n                docOpts,\n            }\n        });\n        return new Document(common_1.DoctypeUtils.deserializeState(state), context, apiUrl, config);\n    }\n    static async applyCommit(apiUrl, docId, commit, context, docOpts = {}) {\n        docId = utils_1.typeDocID(docId);\n        const { state } = await utils_1.fetchJson(apiUrl + '/commits', {\n            method: 'post',\n            body: {\n                docId: docId.toString(),\n                commit: common_1.DoctypeUtils.serializeCommit(commit),\n                docOpts,\n            }\n        });\n        return new Document(common_1.DoctypeUtils.deserializeState(state), context, apiUrl);\n    }\n    static async load(docId, apiUrl, context, config) {\n        docId = utils_1.typeDocID(docId);\n        const { state } = await utils_1.fetchJson(apiUrl + '/documents/' + docId.toString());\n        return new Document(common_1.DoctypeUtils.deserializeState(state), context, apiUrl, config);\n    }\n    static async loadDocumentCommits(docId, apiUrl) {\n        docId = utils_1.typeDocID(docId);\n        const { commits } = await utils_1.fetchJson(apiUrl + '/commits/' + docId.toString());\n        return commits.map((r) => {\n            return {\n                cid: r.cid, value: common_1.DoctypeUtils.deserializeCommit(r.value)\n            };\n        });\n    }\n    async change(params, opts) {\n        const doctype = new this.doctypeLogic(this.state, this.context);\n        await doctype.change(params, opts);\n        this.state = doctype.state;\n    }\n    close() {\n        this._syncEnabled = false;\n    }\n}\nexports.default = Document;\n"},"sourceMaps":{"js":{"version":3,"file":"document.js","sourceRoot":"","sources":["../src/document.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"d2c0d21a05704396a29b916575675c74","cacheData":{"env":{}}}