{"id":"../node_modules/@ceramicnetwork/3id-did-resolver/lib/index.js","dependencies":[{"name":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\3id-did-resolver\\lib\\index.js.map","includedInParent":true,"mtime":499162500000},{"name":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\package.json","includedInParent":true,"mtime":1612734035267},{"name":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\3id-did-resolver\\package.json","includedInParent":true,"mtime":1612644319655},{"name":"./legacyResolver","loc":{"line":26,"column":49},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\3id-did-resolver\\lib\\index.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\3id-did-resolver\\lib\\legacyResolver.js"},{"name":"uint8arrays","loc":{"line":27,"column":33},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\3id-did-resolver\\lib\\index.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\uint8arrays\\index.js"},{"name":"@ceramicnetwork/docid","loc":{"line":28,"column":40},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\3id-did-resolver\\lib\\index.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\docid\\lib\\index.js"},{"name":"cids","loc":{"line":29,"column":39},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\3id-did-resolver\\lib\\index.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\3id-did-resolver\\node_modules\\cids\\src\\index.js"}],"generated":{"js":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.wrapDocument = void 0;\nconst legacyResolver_1 = __importDefault(require(\"./legacyResolver\"));\nconst u8a = __importStar(require(\"uint8arrays\"));\nconst docid_1 = __importDefault(require(\"@ceramicnetwork/docid\"));\nconst cids_1 = __importDefault(require(\"cids\"));\nfunction wrapDocument(content, did) {\n    if (!(content && content.publicKeys))\n        throw new Error('Not a valid 3ID');\n    const startDoc = {\n        '@context': 'https://w3id.org/did/v1',\n        id: did,\n        publicKey: [],\n        authentication: [],\n        keyAgreement: []\n    };\n    const doc = Object.entries(content.publicKeys).reduce((diddoc, [keyName, keyValue]) => {\n        const keyBuf = u8a.fromString(keyValue.slice(1), 'base58btc');\n        const publicKeyBase58 = u8a.toString(keyBuf.slice(2), 'base58btc');\n        if (keyBuf[0] === 0xe7) {\n            diddoc.publicKey.push({\n                id: `${did}#${keyName}`,\n                type: 'Secp256k1VerificationKey2018',\n                controller: did,\n                publicKeyBase58\n            });\n            diddoc.authentication.push({\n                type: 'Secp256k1SignatureAuthentication2018',\n                publicKey: `${did}#${keyName}`,\n            });\n        }\n        else if (keyBuf[0] === 0xec) {\n            diddoc.publicKey.push({\n                id: `${did}#${keyName}`,\n                type: 'Curve25519EncryptionPublicKey',\n                controller: did,\n                publicKeyBase58\n            });\n            diddoc.keyAgreement.push({\n                id: `${did}#${keyName}`,\n                type: 'X25519KeyAgreementKey2019',\n                controller: did,\n                publicKeyBase58\n            });\n        }\n        return diddoc;\n    }, startDoc);\n    return doc;\n}\nexports.wrapDocument = wrapDocument;\nconst isLegacyDid = (didId) => {\n    try {\n        new cids_1.default(didId);\n        return true;\n    }\n    catch (e) {\n        return false;\n    }\n};\nconst getVersion = (query = '') => {\n    const versionParam = query.split('&').find(e => e.includes('version-id'));\n    return versionParam ? versionParam.split('=')[1] : null;\n};\nconst legacyResolve = async (ceramic, didId, commit) => {\n    const legacyPublicKeys = await legacyResolver_1.default(didId);\n    if (!legacyPublicKeys)\n        return null;\n    const legacyDoc = wrapDocument(legacyPublicKeys, `did:3:${didId}`);\n    if (commit === '0')\n        return legacyDoc;\n    try {\n        const docParams = { deterministic: true, metadata: { controllers: [legacyPublicKeys.keyDid], family: '3id' } };\n        const doc = await ceramic.createDocument('tile', docParams, { anchor: false, publish: false });\n        const didDoc = await resolve(ceramic, doc.id.toString(), commit, didId);\n        return didDoc;\n    }\n    catch (e) {\n        if (commit)\n            throw new Error('Not a valid 3ID');\n        return legacyDoc;\n    }\n};\nconst resolve = async (ceramic, didId, commit, v03ID) => {\n    const docId = docid_1.default.fromString(didId, commit);\n    const doctype = await ceramic.loadDocument(docId);\n    return wrapDocument(doctype.content, `did:3:${v03ID || didId}`);\n};\nexports.default = {\n    getResolver: (ceramic) => {\n        return {\n            '3': async (did, parsed) => {\n                const version = getVersion(parsed.query);\n                return isLegacyDid(parsed.id) ? legacyResolve(ceramic, parsed.id, version) : resolve(ceramic, parsed.id, version);\n            }\n        };\n    }\n};\n"},"sourceMaps":{"js":{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"26ed34435c8cef4e10fbd6eb37ef3fcc","cacheData":{"env":{}}}