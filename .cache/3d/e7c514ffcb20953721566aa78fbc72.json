{"id":"../node_modules/dids/lib/index.js","dependencies":[{"name":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\dids\\lib\\index.js.map","includedInParent":true,"mtime":499162500000},{"name":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\package.json","includedInParent":true,"mtime":1612734035267},{"name":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\dids\\package.json","includedInParent":true,"mtime":1612644319653},{"name":"did-resolver","loc":{"line":13,"column":31},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\dids\\lib\\index.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\did-resolver\\lib\\resolver.esm.js"},{"name":"rpc-utils","loc":{"line":14,"column":28},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\dids\\lib\\index.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\rpc-utils\\dist\\rpc-utils.esm.js"},{"name":"did-jwt","loc":{"line":15,"column":26},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\dids\\lib\\index.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\did-jwt\\lib\\index.js"},{"name":"dag-jose-utils","loc":{"line":16,"column":33},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\dids\\lib\\index.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\dag-jose-utils\\lib\\index.js"},{"name":"./utils","loc":{"line":17,"column":24},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\dids\\lib\\index.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\dids\\lib\\utils.js"}],"generated":{"js":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DID = void 0;\nconst did_resolver_1 = require(\"did-resolver\");\nconst rpc_utils_1 = require(\"rpc-utils\");\nconst did_jwt_1 = require(\"did-jwt\");\nconst dag_jose_utils_1 = require(\"dag-jose-utils\");\nconst utils_1 = require(\"./utils\");\nfunction isResolver(resolver) {\n    return 'registry' in resolver && 'cache' in resolver;\n}\nclass DID {\n    constructor({ provider, resolver = {}, cache } = {}) {\n        if (provider != null) {\n            this._client = new rpc_utils_1.RPCClient(provider);\n        }\n        this.setResolver(resolver, cache);\n    }\n    get authenticated() {\n        return this._id != null;\n    }\n    get id() {\n        if (this._id == null) {\n            throw new Error('DID is not authenticated');\n        }\n        return this._id;\n    }\n    setProvider(provider) {\n        if (this._client == null) {\n            this._client = new rpc_utils_1.RPCClient(provider);\n        }\n        else if (this._client.connection !== provider) {\n            throw new Error('A different provider is already set, create a new DID instance to use another provider');\n        }\n    }\n    setResolver(resolver, cache) {\n        this._resolver = isResolver(resolver) ? resolver : new did_resolver_1.Resolver(resolver, cache);\n    }\n    authenticate({ provider, paths, aud } = {}) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (provider != null) {\n                this.setProvider(provider);\n            }\n            if (this._client == null) {\n                throw new Error('No provider available');\n            }\n            const nonce = utils_1.randomString();\n            const jws = yield this._client.request('did_authenticate', {\n                nonce,\n                aud,\n                paths,\n            });\n            const { kid } = yield this.verifyJWS(jws);\n            const payload = utils_1.base64urlToJSON(jws.payload);\n            if (!kid.includes(payload.did))\n                throw new Error('Invalid authencation response, kid mismatch');\n            if (payload.nonce !== nonce)\n                throw new Error('Invalid authencation response, wrong nonce');\n            if (payload.aud !== aud)\n                throw new Error('Invalid authencation response, wrong aud');\n            if (payload.exp < Date.now() / 1000)\n                throw new Error('Invalid authencation response, expired');\n            this._id = payload.did;\n            return this._id;\n        });\n    }\n    createJWS(payload, options = {}) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._client == null)\n                throw new Error('No provider available');\n            if (this._id == null)\n                throw new Error('DID is not authenticated');\n            if (!options.did)\n                options.did = this._id;\n            const { jws } = yield this._client.request('did_createJWS', Object.assign(Object.assign({}, options), { payload }));\n            return jws;\n        });\n    }\n    createDagJWS(payload, options = {}) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const { cid, linkedBlock } = yield dag_jose_utils_1.encodePayload(payload);\n            const payloadCid = utils_1.encodeBase64Url(cid.bytes);\n            Object.assign(options, { linkedBlock: utils_1.encodeBase64(linkedBlock) });\n            const jws = yield this.createJWS(payloadCid, options);\n            jws.link = cid;\n            return { jws, linkedBlock };\n        });\n    }\n    verifyJWS(jws) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (typeof jws !== 'string')\n                jws = utils_1.fromDagJWS(jws);\n            const kid = utils_1.base64urlToJSON(jws.split('.')[0]).kid;\n            if (!kid)\n                throw new Error('No \"kid\" found in jws');\n            const { publicKey } = yield this.resolve(kid);\n            did_jwt_1.verifyJWS(jws, publicKey);\n            let payload;\n            try {\n                payload = utils_1.base64urlToJSON(jws.split('.')[1]);\n            }\n            catch (e) {\n            }\n            return { kid, payload };\n        });\n    }\n    createJWE(cleartext, recipients, options = {}) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const encrypters = yield did_jwt_1.resolveX25519Encrypters(recipients, this._resolver);\n            return did_jwt_1.createJWE(cleartext, encrypters, options.protectedHeader, options.aad);\n        });\n    }\n    createDagJWE(cleartext, recipients, options = {}) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.createJWE(dag_jose_utils_1.prepareCleartext(cleartext), recipients, options);\n        });\n    }\n    decryptJWE(jwe, options = {}) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._client == null)\n                throw new Error('No provider available');\n            if (this._id == null)\n                throw new Error('DID is not authenticated');\n            if (!options.did)\n                options.did = this._id;\n            const { cleartext } = yield this._client.request('did_decryptJWE', Object.assign(Object.assign({}, options), { jwe }));\n            return utils_1.decodeBase64(cleartext);\n        });\n    }\n    decryptDagJWE(jwe) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const bytes = yield this.decryptJWE(jwe);\n            return dag_jose_utils_1.decodeCleartext(bytes);\n        });\n    }\n    resolve(didUrl) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return yield this._resolver.resolve(didUrl);\n        });\n    }\n}\nexports.DID = DID;\n"},"sourceMaps":{"js":{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"f8e75b9d5373050e10cbf636ab1a8c5b","cacheData":{"env":{}}}