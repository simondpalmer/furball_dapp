{"id":"../node_modules/@ceramicnetwork/3id-did-resolver/lib/legacyResolver.js","dependencies":[{"name":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\3id-did-resolver\\lib\\legacyResolver.js.map","includedInParent":true,"mtime":499162500000},{"name":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\package.json","includedInParent":true,"mtime":1612734035267},{"name":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\3id-did-resolver\\package.json","includedInParent":true,"mtime":1612644319655},{"name":"cross-fetch","loc":{"line":25,"column":46},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\3id-did-resolver\\lib\\legacyResolver.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\3id-did-resolver\\node_modules\\cross-fetch\\dist\\browser-ponyfill.js"},{"name":"uint8arrays","loc":{"line":26,"column":33},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\3id-did-resolver\\lib\\legacyResolver.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\uint8arrays\\index.js"},{"name":"lru_map","loc":{"line":27,"column":26},"parent":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\@ceramicnetwork\\3id-did-resolver\\lib\\legacyResolver.js","resolved":"C:\\Users\\Simon Palmer\\Documents\\Programming\\ETHDenver 2021\\furball-dapp\\node_modules\\lru_map\\dist\\lru.js"}],"generated":{"js":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst cross_fetch_1 = __importDefault(require(\"cross-fetch\"));\nconst u8a = __importStar(require(\"uint8arrays\"));\nconst lru_map_1 = require(\"lru_map\");\nconst THREEBOX_API_URL = 'https://ipfs.3box.io';\nconst LIMIT = 100;\nconst fetchCache = new lru_map_1.LRUMap(LIMIT);\nconst fetchJson = async (url) => {\n    const cached = fetchCache.get(url);\n    if (cached)\n        return cached;\n    const r = await cross_fetch_1.default(url);\n    if (r.ok) {\n        const json = await r.json();\n        fetchCache.set(url, json);\n        return json;\n    }\n    else {\n        throw new Error('Not a valid 3ID');\n    }\n};\nconst didDocReq = (cid) => `${THREEBOX_API_URL}/did-doc?cid=${encodeURIComponent(cid)}`;\nconst ipfsMock = {\n    dag: {\n        get: async (cid) => fetchJson(didDocReq(cid))\n    }\n};\nconst encodeKey = (key, encryption) => {\n    const bytes = new Uint8Array(key.length + 2);\n    if (encryption) {\n        bytes[0] = 0xec;\n    }\n    else {\n        bytes[0] = 0xe7;\n    }\n    bytes[1] = 0x01;\n    bytes.set(key, 2);\n    return `z${u8a.toString(bytes, 'base58btc')}`;\n};\nconst compressKey = (key) => {\n    const xpoint = key.slice(2, 66);\n    const ypoint = key.slice(66, 130);\n    const prefix = (ypoint & 1) === 0 ? '02' : '03';\n    return `${prefix}${xpoint}`;\n};\nconst LegacyResolver = async (didId, ipfs = ipfsMock) => {\n    const doc = (await ipfs.dag.get(didId)).value;\n    let signingKey, encryptionKey;\n    try {\n        const keyEntrySigning = doc.publicKey.findIndex(e => e.id.endsWith('signingKey'));\n        const keyEntryEncryption = doc.publicKey.findIndex(e => e.id.endsWith('encryptionKey'));\n        signingKey = doc.publicKey[keyEntrySigning].publicKeyHex;\n        encryptionKey = doc.publicKey[keyEntryEncryption].publicKeyBase64;\n    }\n    catch (e) {\n        throw new Error('Not a valid 3ID');\n    }\n    const signingKeyCompressed = compressKey(signingKey);\n    const signing = encodeKey(u8a.fromString(signingKeyCompressed, 'base16'));\n    const encryption = encodeKey(u8a.fromString(encryptionKey, 'base64pad'), true);\n    return {\n        keyDid: `did:key:${signing}`,\n        publicKeys: {\n            [signing.slice(-15)]: signing,\n            [encryption.slice(-15)]: encryption,\n        }\n    };\n};\nexports.default = LegacyResolver;\n"},"sourceMaps":{"js":{"version":3,"file":"legacyResolver.js","sourceRoot":"","sources":["../src/legacyResolver.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"9c698900988167c049463d5d9424b233","cacheData":{"env":{}}}